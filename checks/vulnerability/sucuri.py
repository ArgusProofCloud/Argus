#!/usr/bin/python3
import sys
import json
import socket

import requests

def getScores(hostName: str):
    """Get scores from sucuri.
    """
    response = requests.get("https://sitecheck.sucuri.net/api/v3/?scan=" + hostName)

    scoreMap = {
        "A": 10,
        "B": 5,
        "C": 0
    }

    totalScore = -1
    securityScore = -1

    if "total" in response["ratings"]:
        totalScore = scoreMap[response["ratings"]["total"]["rating"]]

    if "security" in response["ratings"]:
        totalScore = scoreMap[response["ratings"]["security"]["rating"]]

    return {
        "totalScore": totalScore,
        "securityScore": securityScore
    }

def main(type:str,domain:str):
    """ Main Method
    Args:
        type (str): ip,domain
        domain (str): name of domain or ip
    """

    if type=="domain":
        hostName = domain
    elif type=="ip":
        hostName = socket.gethostbyaddr(domain)[0]
    elif type=="ipv6":
        hostName = socket.gethostbyaddr(domain)[0]

    try:
        scores = getScores(hostName)
    except:
        print("{}")
        exit()

    results.append(
        {
            "name": "Sucuri Total Score",
            "score": scores["totalScore"],
            "message": "The total rating from Sucuri.",
            "description": "sucuri"
        })

    results.append(
        {
            "name": "Sucuri Security Score",
            "score": totalScore["securityScore"],
            "message": "The security rating from Sucuri.",
            "description": "sucuri"
        })

    print(json.dumps(results))

if __name__ == "__main__":
    main(sys.argv[1],sys.argv[2])
