#!/usr/bin/python3
import json
import requests
import sys
import socket
results=[]

def main(type:str,domain:str):

    """_summary_
    Args:
        type (str): ip,domain
        domain (str): name of domain or ip
    """

    if type=="domain":
        host_name = domain
    elif type=="ip":
        host_name = socket.gethostbyaddr(domain)[0]
    elif type=="ipv6":
        host_name = socket.gethostbyaddr(domain)[0]

    response = requests.get("https://sitecheck.sucuri.net/api/v3/?scan="+host_name)
    scanresult='ratings'
    ratingscore='rating'

    A=10
    B=5
    C=0
    X=-1

    responsedr=json.loads(response.text)
    try:
        tlsscore=responsedr[scanresult]['tls'][ratingscore]
    except:
        tlsscore=X
    try:
        totalscore=responsedr[scanresult]['total'][ratingscore]
    except:
        totalscore=X
    try:
        securityscore=responsedr[scanresult]['security'][ratingscore]
    except:
        securityscore=X

    scorelistletter=[tlsscore,totalscore,securityscore]
    Scorenumber=[]
    for i in scorelistletter:
        if i == "A":
            Scorenumber.append(A)
        if i == "B":
            Scorenumber.append(B)
        if i == "C":
            Scorenumber.append(C)
        if i == X:
            Scorenumber.append(X)

    results.append(
        {
            "name": "malware, tls",
            "score":Scorenumber[0],
            "message":"tls score generated by Sucuri: " + str(Scorenumber[0]),
            "description":"malware"
        })
    results.append(
        {
            "name": "malware, total",
            "score": Scorenumber[1],
            "message": "total score generated by Sucuri: " + str(Scorenumber[1]),
            "description": "malware"
        })

    results.append(
        {
            "name": "malware, security",
            "score": Scorenumber[2],
            "message": "security score generated by Sucuri: " + str(Scorenumber[2]),
            "description": "malware"
        })
    try:
        warning=responsedr['warnings']
        if  warning:
            results.append(
                {
                    "name":"malware",
                    "score":C,
                    "message":"Sucuri warning is found.",
                    "description":"malware"
                })

    except:
        results.append(
            {
                "name":"malware",
                "score":A,
                "message":"Sucuri warning not found.",
                "description":"malware"
            })


if __name__ == "__main__":
    main(sys.argv[1],sys.argv[2])
    print(results)
